<!doctype html>
<html lang="en">
<meta charset="utf-8" />
<title>Bolt Hole Layout – Pure HTML + SVG</title>
<style>
  body { font-family: system-ui, sans-serif; margin: 16px; background:#f8fafc; }
  .grid { display: grid; grid-template-columns: 380px 1fr; gap: 16px; align-items: start; }
  .card { background:#fff; border:1px solid #e5e7eb; border-radius:16px; padding:12px; box-shadow: 0 1px 2px rgba(0,0,0,.04); }
  label { display:block; margin:10px 0; }
  input[type="number"] { width: 90px; margin-left: 8px; }
  input[type="range"] { width: 100%; }
  .out { display:grid; grid-template-columns: 1fr 1fr; gap:8px; margin-top:8px; }
  .muted { color:#6b7280; font-size:12px; }
</style>

<div class="grid">
  <div class="card">
    <h2>Bolt Hole Layout (Pure HTML + SVG)</h2>
    <label>PCD (mm):
      <input id="pcdRange" type="range" min="10" max="600" value="100" step="1">
      <input id="pcdNum" type="number" value="100" step="1">
    </label>
    <label>Hole Ø (mm):
      <input id="diaRange" type="range" min="0.1" max="200" value="10" step="0.1">
      <input id="diaNum" type="number" value="10" step="0.1">
    </label>
    <label>Number of holes:
      <input id="nRange" type="range" min="2" max="60" value="10" step="1">
      <input id="nNum" type="number" value="10" step="1">
    </label>
    <label>
      <input id="fixedScale" type="checkbox" checked>
      Fixed scale (keep visual Ø constant)
    </label>

    <div class="out card">
      <div>
        <div class="muted">Chord ligament</div>
        <div id="outChord">—</div>
        <div class="muted">= PCD·sin(π/N) − Ø</div>
      </div>
      <div>
        <div class="muted">Arc ligament</div>
        <div id="outArc">—</div>
        <div class="muted">= π·PCD/N − Ø</div>
      </div>
    </div>

    <div class="muted" style="margin-top:8px" id="debug"></div>
  </div>

  <div class="card">
    <!-- Square SVG viewport -->
    <svg id="viz" width="640" height="640" viewBox="0 0 640 640" role="img" aria-label="Bolt hole layout visualization">
      <!-- drawn dynamically by script -->
    </svg>
  </div>
</div>

<script>
const els = {
  pcdR: document.getElementById('pcdRange'),
  pcdN: document.getElementById('pcdNum'),
  diaR: document.getElementById('diaRange'),
  diaN: document.getElementById('diaNum'),
  nR: document.getElementById('nRange'),
  nN: document.getElementById('nNum'),
  fixed: document.getElementById('fixedScale'),
  outChord: document.getElementById('outChord'),
  outArc: document.getElementById('outArc'),
  debug: document.getElementById('debug'),
  svg: document.getElementById('viz')
};

function sync(a, b) {
  a.addEventListener('input', () => { b.value = a.value; draw(); });
  b.addEventListener('input', () => { a.value = b.value; draw(); });
}

sync(els.pcdR, els.pcdN);
sync(els.diaR, els.diaN);
sync(els.nR, els.nN);
els.fixed.addEventListener('change', draw);

function draw() {
  const PCD = +els.pcdN.value;
  const DIA = +els.diaN.value;
  const N   = Math.max(2, Math.floor(+els.nN.value));
  const R = PCD / 2;

  // Outputs
  const chord = Math.max(0, PCD * Math.sin(Math.PI / N) - DIA);
  const arc   = Math.max(0, Math.PI * PCD / N - DIA);
  els.outChord.textContent = chord.toFixed(2) + ' mm';
  els.outArc.textContent = arc.toFixed(2) + ' mm';

  // Scaling
  const W = 640, H = 640, margin = 28;
  const maxR = Math.min(W, H)/2 - margin;
  const fixed = els.fixed.checked;
  const DESIGN_MAX_PCD = 400; // mm that fills viewport at fixed scale
  const scale = fixed ? (maxR / (DESIGN_MAX_PCD/2)) : (R>0 ? maxR / R : 1);
  const cx = W/2, cy = H/2; // SVG center

  // Clear SVG
  els.svg.replaceChildren();

  // Pitch circle
  const pc = circle(cx, cy, R*scale, {fill:'none', stroke:'black','stroke-width':2,'stroke-dasharray':'6 6'});
  els.svg.appendChild(pc);
  // PCD centerline
  els.svg.appendChild(line(cx-R*scale, cy, cx+R*scale, cy, {stroke:'black','stroke-width':2,'stroke-dasharray':'10 6 2 6'}));
  // Center dot
  els.svg.appendChild(circle(cx, cy, 3, {fill:'black'}));

  // Holes
  const holes = [];
  for (let i=0;i<N;i++) {
    const a = 2*Math.PI*i/N;
    const xmm = R*Math.cos(a);
    const ymm = R*Math.sin(a);
    const x = cx + xmm*scale;
    const y = cy - ymm*scale; // flip Y for math orientation
    holes.push({x,y});
    els.svg.appendChild(circle(x, y, (DIA/2)*scale, {fill:'black', opacity:0.9}));
  }

  // Chord between first two holes (edge-to-edge segment in green)
  if (holes.length >= 2) {
    const p0 = holes[0], p1 = holes[1];
    const dx = p1.x - p0.x, dy = p1.y - p0.y;
    const L = Math.hypot(dx, dy);
    const ux = dx/L, uy = dy/L;
    const e0x = p0.x + ux*(DIA/2)*scale;
    const e0y = p0.y + uy*(DIA/2)*scale;
    const e1x = p1.x - ux*(DIA/2)*scale;
    const e1y = p1.y - uy*(DIA/2)*scale;
    els.svg.appendChild(line(e0x, e0y, e1x, e1y, {stroke:'green','stroke-width':4}));
    // label
    const midx = (e0x+e1x)/2, midy = (e0y+e1y)/2;
    els.svg.appendChild(text(midx, midy-8, chord.toFixed(2)+' mm', {fill:'green','font-size':12,'text-anchor':'middle'}));
  }

  // Debug
  els.debug.textContent = `PCD=${PCD} mm, Ø=${DIA} mm, N=${N}, R=${R.toFixed(2)} mm, scale=${scale.toFixed(3)} px/mm (${fixed?'fixed':'auto'})`;
}

// tiny SVG helpers
function circle(cx, cy, r, attrs={}){ const e=document.createElementNS('http://www.w3.org/2000/svg','circle'); e.setAttribute('cx',cx); e.setAttribute('cy',cy); e.setAttribute('r',r); set(e,attrs); return e; }
function line(x1,y1,x2,y2,attrs={}){ const e=document.createElementNS('http://www.w3.org/2000/svg','line'); e.setAttribute('x1',x1); e.setAttribute('y1',y1); e.setAttribute('x2',x2); e.setAttribute('y2',y2); set(e,attrs); return e; }
function text(x,y,str,attrs={}){ const e=document.createElementNS('http://www.w3.org/2000/svg','text'); e.setAttribute('x',x); e.setAttribute('y',y); e.textContent=str; set(e,attrs); return e; }
function set(el, attrs){ for (const k in attrs) el.setAttribute(k, attrs[k]); }

draw();
</script>
</html>
